<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: Escape Back Referencing</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, regex, syntax"/>

  </head>

  <body>
    <div class="world">
      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/60-escape-back-referencing.html">Escape Back Referencing</a></h1>
      </section>

      <article class="post">
        <p>Ruby has more than one way to access additional information about the most recent regex match, like captured groups. One way is using the <a href="/9-globalization.html">special variables <code>$`</code>, <code>$&amp;</code>, <code>$'</code>, <code>$1</code> - <code>$9</code>, <code>$+</code></a>, and also in the <a href="https://ruby-doc.org/core/MatchData.html">MatchData</a> object <code>$~</code>. They become available after using a method that matched a regex, or when the method supports a block, they are already available in the block.</p>

<p></p>

<p>However, there is also a special string processing supported by the string replacement methods <a href="https://ruby-doc.org/core/String.html#method-i-gsub">String#gsub</a> and <a href="https://ruby-doc.org/core/String.html#method-i-sub">String#sub</a>. The replacement string (second parameter) can contain <strong>back references</strong>, which behave similarly to their corresponding special variable:</p>

<pre><code>"Idiosyncratic Ruby".sub(/(\w+) (\w+)/, '\2 \1') # =&gt; "Ruby Idiosyncratic"
</code></pre>

<h2 id="special-regex-variables--back-references">Special Regex Variables &amp; Back References</h2>

<table class="table-15-15-20-X">
  <thead>
    <tr>
      <th>Perlish</th>
      <th>Back-Ref</th>
      <th>Effect</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>$&amp;</code></td>
      <td><code>'\&amp;'</code>, <code>'\0'</code>¹</td>
      <td>Match</td>
      <td><code>"abc".gsub(/.*/, '\&amp;\&amp;') # =&gt; "abcabc"</code></td>
    </tr>
    <tr>
      <td><code>$`</code></td>
      <td><code>'\`'</code></td>
      <td>Pre Match</td>
      <td><code>"abc".gsub(/b/, '\`') # =&gt; "aac"</code></td>
    </tr>
    <tr>
      <td><code>$'</code></td>
      <td><code>'\\\''</code></td>
      <td>Post Match</td>
      <td><code>"abc".gsub(/b/, '\\\'') # =&gt; "acc"</code></td>
    </tr>
    <tr>
      <td><code>$1</code>²</td>
      <td><code>'\1'</code></td>
      <td>1st Capture</td>
      <td><code>"abc".gsub(/(a)b(c)/, '\1') # =&gt; "a"</code></td>
    </tr>
    <tr>
      <td><code>$+</code></td>
      <td><code>'\+'</code></td>
      <td>Last Capture</td>
      <td><code>"abc".gsub(/(a)b(c)/, '\+') # =&gt; "c"</code></td>
    </tr>
    <tr>
      <td><code>$~[:name]</code></td>
      <td><code>'\k&lt;name&gt;'</code></td>
      <td>Named Capture</td>
      <td><code>"abc".gsub(/(?&lt;name&gt;a)bc/, '\k&lt;name&gt;') # =&gt; "a"</code></td>
    </tr>
  </tbody>
</table>

<h2 id="escaping">Escaping</h2>

<p>Ruby is absolutely confusing when it comes to how to escape back references. You have to use one or two backspaces when using single quoted strings. You have to use two (or sometimes three) backspaces when using double quoted strings. Escaping <code>\'</code> needs special attention³:</p>

<table>
  <thead>
    <tr>
      <th>X</th>
      <th><code>'\X'</code></th>
      <th><code>'\\X'</code></th>
      <th><code>'\\\X'</code></th>
      <th><code>"\X"</code></th>
      <th><code>"\\X"</code></th>
      <th><code>"\\\X"</code></th>
      <th><code>"\\\\X"</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>&amp;</td>
      <td>Match</td>
      <td>Match</td>
      <td><code>"\\&amp;"</code></td>
      <td><code>"&amp;"</code></td>
      <td>Match</td>
      <td>Match</td>
      <td><code>"\\&amp;"</code></td>
    </tr>
    <tr>
      <td>`</td>
      <td>Pre-Match</td>
      <td>Pre-Match</td>
      <td><code>"\\`"</code></td>
      <td><code>"`"</code></td>
      <td>Pre-Match</td>
      <td>Pre-Match</td>
      <td><code>"\\`"</code></td>
    </tr>
    <tr>
      <td>'</td>
      <td><code>"'"</code></td>
      <td>-</td>
      <td>Post-Match</td>
      <td><code>"'"</code></td>
      <td>Post-Match</td>
      <td>Post-Match</td>
      <td><code>"\\'"</code></td>
    </tr>
    <tr>
      <td>0¹</td>
      <td>Match</td>
      <td>Match</td>
      <td><code>"\\0"</code></td>
      <td><code>"\u0000"</code></td>
      <td>Match</td>
      <td><code>"\\\u0000"</code></td>
      <td><code>"\\0"</code></td>
    </tr>
    <tr>
      <td>1²</td>
      <td>1st Capture</td>
      <td>1st Capture</td>
      <td><code>"\\1"</code></td>
      <td><code>"\u0001"</code></td>
      <td>1st Capture</td>
      <td><code>"\\\u0001"</code></td>
      <td><code>"\\1"</code></td>
    </tr>
    <tr>
      <td>+</td>
      <td>Last Capture</td>
      <td>Last Capture</td>
      <td><code>"\\+"</code></td>
      <td><code>"+"</code></td>
      <td>Last Capture</td>
      <td>Last Capture</td>
      <td><code>"\\+"</code></td>
    </tr>
    <tr>
      <td>k&lt;name&gt;</td>
      <td>Named Capture</td>
      <td>Named Capture</td>
      <td><code>"\\k&lt;name&gt;"</code></td>
      <td><code>"k&lt;name&gt;"</code></td>
      <td>Named Capture</td>
      <td>Named Capture</td>
      <td><code>"\\k&lt;name&gt;"</code></td>
    </tr>
  </tbody>
</table>

<p>¹ Although the global variable <code>$0</code> is not related to regex matching, <code>\0</code> is a valid back reference.<br />
² Same for 2-9: Nth Capture<br />
³ If you want to replace <code>'</code> with <code>\'</code> (backspace quote, no back-ref), the replacement string is: <code>'\\\\\''</code></p>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/0998097e41369176ba27870f9b78cbfdfe84b363#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/61-meta-escape-control.html">Meta Escape Control</a></li>
            <li>Previous Article: <a href="/59-big-data-without-end.html">Big Data Without End</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Regex, Syntax<br>
        Last Update: July 30, 2018
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>