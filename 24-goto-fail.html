<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: Goto Fail</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/pagemap.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, syntax, core, easter-egg"/>

  </head>

  <body>
    <div class="world">
      <canvas id="map"></canvas>

      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/24-goto-fail.html">Goto Fail</a></h1>
      </section>

      <article class="post">
        <p>If you change one line in Ruby's source, it will support <strong>goto</strong> statements!</p>

<p></p>

<p>You can install a patched version via <strong>RVM</strong>'s patch feature:</p>

<pre><code>$ rvm install 2.2.2 -n goto --patch http://git.io/vfxF2
$ rvm use 2.2.2-goto
</code></pre>

<p>What to do to play around with this new feature? Let's reimplement <a href="https://nakedsecurity.sophos.com/2014/02/24/anatomy-of-a-goto-fail-apples-ssl-bug-explained-plus-an-unofficial-patch/">this famous bug</a> in Ruby:</p>

<pre><code># prepare some dummy data
hashCtx = hashOut = clientRandom = serverRandom = signedRandom = Object.new
SSLHashSHA1 = Class.new do def update(*) end; alias final update end.new

# how the goto fail bug would look like if it was implemented in ruby
__goto__(:fail) if ((err = SSLHashSHA1.update(hashCtx, clientRandom)) != 0);
__goto__(:fail) if ((err = SSLHashSHA1.update(hashCtx, serverRandom)) != 0);
__goto__(:fail) if ((err = SSLHashSHA1.update(hashCtx, signedParams)) != 0);
__goto__(:fail);
__goto__(:fail) if ((err = SSLHashSHA1.final(hashCtx, hashOut)) != 0);

puts "Verified" # never reached
# ...

__label__(:fail);
puts "Failed";
</code></pre>

<p>Executing this with gotoruby:</p>

<pre><code>$ rvm use 2.2.2-goto
$ ruby gotofail.rb
Failed
</code></pre>

<h2 id="further-reading">Further Reading</h2>
<ul>
  <li><a href="http://patshaughnessy.net/2012/2/29/the-joke-is-on-us-how-ruby-1-9-supports-the-goto-statement">Article: The Joke Is On Us: How Ruby 1.9 Supports the Goto Statement</a></li>
  <li>Ruby's other goto: <a href="http://gnuu.org/2009/03/21/demystifying-continuations-in-ruby/">Article: Demystifying Continuations in Ruby</a></li>
</ul>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/ccb9a26940badccbdda3a8b5dc61f28b2b8a614f#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/25-meta-methodology.html">Meta Methodology</a></li>
            <li>Previous Article: <a href="/23-ruby-lookalikes.html">Ruby Lookalikes</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Syntax, Core, Easter-egg<br>
        Last Update: May 24, 2015
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>