<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: Operating Nothing</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, core, strings"/>

  </head>

  <body>
    <div class="world">
      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/28-operating-nothing.html">Operating Nothing</a></h1>
      </section>

      <article class="post">
        <p>There is an operator in Ruby, that does nothing: The <a href="https://github.com/ruby/ruby/blob/v2_2_2/numeric.c#L367-L371">unary plus operator</a>. It is part of the language for <a href="https://stackoverflow.com/questions/5680587/whats-the-point-of-unary-plus-operator-in-ruby">keeping symmetry with the unary minus operator</a>!</p>

<p></p>

<p>This is awesome, an operator for free! How can we utilize it?</p>

<p><strong>Update:</strong> In Ruby 2.3, the plus operator got its first purpose: <a href="https://bugs.ruby-lang.org/issues/11782">Create an unfrozen copy of a string</a></p>

<pre><code>string = "frozen string".freeze
string.object_id # =&gt; 19066860
string.frozen? # =&gt; true

copy = +string
copy.object_id # =&gt; 19012140
copy.frozen? # =&gt; false
</code></pre>

<h2 id="logging">1 | Logging</h2>

<pre><code>require 'logger'

# Definition
$logger = Logger.new(STDOUT)

class Object
  def +@
    $logger.warn(self.inspect)
  end
end

# Usage
+/Ruby/
# =&gt; W, [2015-05-28T10:52:51.115334 #16630]  WARN -- : /Ruby/
</code></pre>

<p>We could use it for logging. But this is more of the category <em>nice, but feels like there is no real reason for the syntactic sugar</em>.</p>

<h2 id="null-objects">2 | Null Objects</h2>

<p>A more useful case would be to simplify often done object conversions, for example, converting <a href="http://devblog.avdi.org/2011/05/30/null-objects-and-falsiness/">null objects</a> to actual <code>nil</code> for comparisons:</p>

<pre><code># Definition
class Object
  def +@
    null? ? nil : self
  end

  def null?
    false
  end
end

class NilClass
  def null?
    true
  end
end

# Usage
class CustomNullObject
  def null?
    true
  end
end

null = CustomNullObject.new

+nil #=&gt; nil
+null #=&gt; nil
+"Ruby" #=&gt; "Ruby"
</code></pre>

<p>See <a href="https://github.com/janlelis/null_question">null_question</a> and <a href="https://github.com/janlelis/null_plus">null_plus</a> for a gemified version of the code above.</p>

<h2 id="symbol-conversion">3 | Symbol Conversion</h2>

<p>Another conversion related use of <code>+@</code> is the following snippet, which also defines <code>-@</code>. It will convert <code>String</code> and <code>Symbol</code> into each other's representation. It can be used as some kind of alternative to libraries that provide <a href="http://api.rubyonrails.org/classes/ActiveSupport/HashWithIndifferentAccess.html">HashWithIndifferentAccess</a>-kind functionality, by always explicitly converting the key:</p>

<pre><code># Definition
class String
  def +@
    self
  end

  def -@
    to_sym
  end
end

class Symbol
  def +@
    to_s
  end

  def -@
    self
  end
end

# Usage
hash   = { key: "value" }
symbol = :key
string = "key"

hash[-symbol] # =&gt; "value"
hash[-string] # =&gt; "value"
</code></pre>

<p>By the way, this would not be needed, if we <a href="https://speakerdeck.com/sferik/symbols">make symbols frozen strings</a>!</p>

<h2 id="test-rocket">4 | Test Rocket!</h2>

<p>Thinking further: How to get most of out operators? How about a testing framework:</p>

<pre><code>require 'testrocket'

# BASIC USAGE
# +-&gt; { block that should succeed }
# --&gt; { block that should fail }

+-&gt; { Die.new(2) }
--&gt; { raise }
+-&gt; { 2 + 2 == 4 }

# These two tests will deliberately fail
+-&gt; { raise }
--&gt; { true }

# A 'pending' test
~-&gt; { "this is a pending test" }

# A description
!-&gt; { "use this for descriptive output and to separate your test parts" }
</code></pre>

<p>See <a href="https://github.com/peterc/testrocket">peterc/testrocket</a> for further info!</p>

<h2 id="superators">5 | Superators!</h2>

<p>There was a library that carried operator magic to the extremes: It let you define <em>superators</em>, which are new binary operators that use a chain of unary operators as their name! This is what it looked like:</p>

<pre><code># Definition
class Array
  superator "&lt;---" do |operand|
    if operand.kind_of? Array
      self + operand.map { |x| x.inspect }
    else
      operand.inspect
    end
  end
end

# Usage
[1,2,3] &lt;--- [4,5,6]
</code></pre>

<p>The library is not maintained, anymore, but it is the craziest leveraging of Ruby's capabilities I've ever seen! The repo is at <a href="https://github.com/jicksta/superators">jicksta/superators</a>.</p>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/c32ba09fcb552e7ff87e2ba22442bbd6c138b6de#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/29-limitations-of-language.html">Limitations of Language</a></li>
            <li>Previous Article: <a href="/27-golfing-basics.html">Golfing Basics</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          Article Contributions by: Yauheni Dakuka<br>
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Core, Strings<br>
        Last Update: July 09, 2018
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>