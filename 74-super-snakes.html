<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: Super Snakes</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/pagemap.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, core"/>

  </head>

  <body>
    <div class="world">
      <canvas id="map"></canvas>

      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/74-super-snakes.html">Super Snakes</a></h1>
      </section>

      <article class="post">
        <p>Have you ever been confused by the <strong>__underscores__</strong> required by some of <strong>__RUBY__</strong>'s features? You can get it right with this overview of all of "super snake" keywords and methods.</p>

<p></p>

<p>There are three different types of underscore-wrapped syntaxes in the Ruby core language:</p>

<ul>
  <li>keywords</li>
  <li><strong>Object</strong> methods and</li>
  <li><strong>Kernel</strong> methods.</li>
</ul>

<p>Let us take a look at each of them, and understand the motivations behind. Or directly jump to:</p>

<p><a href="#file">__FILE__</a><a href="#line">__LINE__</a><a href="#encoding">__ENCODING__</a><a href="#end">__END__</a><a href="#method-and-callee">__method__</a><a href="#method-and-callee">__callee__</a><a href="#dir">__dir__</a><a href="#id">__id__</a><a href="#send">__send__</a></p>

<h2 id="keywords-built-into-ruby-syntax">Keywords (Built into Ruby Syntax)</h2>

<p>These are directly translated by the Ruby interpreter: You cannot use meta-programming with these, since they will always return the corresponding value directly:</p>

<h3 id="file">__FILE__</h3>

<p>Returns the current source file's name. Might be special value for unusual invocations:</p>

<table>
  <thead>
    <tr>
      <th>Context</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>File, directly executed</td>
      <td>path name, can be relative</td>
    </tr>
    <tr>
      <td>File, required / loaded</td>
      <td>absolute path</td>
    </tr>
    <tr>
      <td>IRB</td>
      <td><code>"(irb)"</code></td>
    </tr>
    <tr>
      <td><a href="https://ruby-doc.org/core/Kernel.html#method-i-eval">eval</a>'d</td>
      <td><code>"(eval)"</code></td>
    </tr>
    <tr>
      <td><code>$ ruby -e</code></td>
      <td><code>"-e"</code></td>
    </tr>
    <tr>
      <td>Standard Input</td>
      <td><code>"-"</code></td>
    </tr>
  </tbody>
</table>

<h3 id="line">__LINE__</h3>

<p>Returns the line number in the current source file. Also works in IRB and with code executed with <code>$ ruby -e</code>, <strong>STDIN</strong> or <code>eval</code>.</p>

<h3 id="encoding">__ENCODING__</h3>

<p>Returns the source file's <a href="https://ruby-doc.org/core/Encoding.html">encoding</a>, as specified per <a href="/58-magic-instructions.html">magic comment</a>. The default source file encoding is UTF-8. The important thing to understand is that this value should correspond to the actual encoding of the source file, so to change the source encoding, it is not enough to just change the magic comment, you will also need to convert the source file.</p>

<p>You should also note that this is unrelated to some other global encoding configurations, which serve different purposes:</p>

<ul>
  <li><a href="https://ruby-doc.org/core/Encoding.html#class-Encoding-label-External+encoding">Encoding.default_external</a></li>
  <li><a href="https://ruby-doc.org/core/Encoding.html#class-Encoding-label-Internal+encoding">Encoding.default_internal</a></li>
</ul>

<h3 id="end-at-beginning-of-line">__END__ (at beginning of line)</h3>

<p>A special syntax which will end the source file earlier and create <a href="/59-big-data-without-end.html">big data</a>.</p>

<h2 id="underscore-wrapped-kernel-methods">Underscore-Wrapped <code>Kernel</code> Methods</h2>

<p>These special Kernel methods are lowercased to highlight the fact that they are actually just methods and no built-in keywords.</p>

<h3 id="method-and-callee">__method__ and __callee__</h3>

<p>Both return the current method's name, but they differ in a detail: When using a method alias, <code>__callee__</code> will return the aliased method name, while <code>__method__</code> would return the original name:</p>

<pre><code>def example!
  p [__method__, __callee__]
end
alias test! example!

example! # =&gt; [:example!, :example!]
test! # =&gt; [:example!, :test!]
</code></pre>

<p>Two similar and useful methods are <a href="https://ruby-doc.org/core/Kernel.html#method-i-caller">Kernel#caller</a> and <a href="https://ruby-doc.org/core/Kernel.html#method-i-caller_locations">Kernel#caller_locations</a>, which provide some more context.</p>

<h3 id="dir">__dir__</h3>

<p>Returns <code>File.dirname(File.realpath(__FILE__))</code>, which is the absolute path of the directory of the current source file.</p>

<p>While it also works in IRB, it will return <code>nil</code> in eval, <code>$ ruby -e</code>, and <strong>STDIN</strong> contexts.</p>

<h2 id="underscore-wrapped-basicobject-methods">Underscore-Wrapped <code>BasicObject</code> Methods</h2>

<p>Both of the following methods are so important that every object (even those that inherit from <a href="https://ruby-doc.org/core/BasicObject.html">BasicObject</a> directly) should have. This is why they got some underscore companions.</p>

<h3 id="id">__id__</h3>

<p>Returns the object id, just like <a href="https://ruby-doc.org/core/Object.html#method-i-object_id">Object#object_id</a>. It mainly exists for historical reasons, most people use <code>object_id</code> nowadays.</p>

<h3 id="send">__send__</h3>

<p>The <code>__send__</code> method is an alias of the <a href="https://ruby-doc.org/core/Object.html#method-i-send">Object#send</a>, which dynamically calls the method given as a symbol argument. Its purpose is that you should still be able to use the <em>send functionality</em> in case someone redefines the <code>send</code> method. The interpreter will issue a warning¹ should you try to redefine or remove it:</p>

<pre><code>warning: redefining `__send__' may cause serious problems
</code></pre>

<p>Nevertheless, it is probably not a good idea either to redefine non-underscore-wrapped <code>send</code>, since a lot of meta-programming relies on it…</p>

<p>¹ This is not true for <code>__id__</code> - Ruby will not complain if you choose to redefine it. It will complain for <code>object_id</code> though.</p>

<h2 id="also-see">Also See</h2>

<ul>
  <li><a href="/5-constant-shadows.html">Episode 5: Constant Shadows</a> (even another way Ruby uses underscores)</li>
  <li><a href="/19-semantic-symbols.html">Episode 19: Symbolic Reservations</a> (in certain cases, symbols with underscores can be special)</li>
</ul>

<p>Many thanks to <a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/a5268be57200ea7caba0f182de25e4d954df6887#commitcomment-41542806">Shannon Skipper for pointing out</a> that <a href="/24-goto-fail.html">the mysterious <code>SUPPORT_JOKE</code> compiler option's <code>__goto__</code> and <code>__label__</code> also make use of underscores</a></p>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/a5268be57200ea7caba0f182de25e4d954df6887#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/75-ruby-tricks-of-2018.html">Ruby TRICKS of 2018</a></li>
            <li>Previous Article: <a href="/73-unicode-version-mapping.html">Unicode Version Mapping</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Core<br>
        Last Update: August 19, 2020
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>