<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: Symbolic Reservations</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, core, enumerable, symbols"/>

  </head>

  <body>
    <div class="world">
      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/19-semantic-symbols.html">Symbolic Reservations</a></h1>
      </section>

      <article class="post">
        <p>This episode takes a look at the unusual use of symbols in one of Ruby's core APIs:</p>

<p></p>

<h2 id="enumerablechunk"><code>Enumerable#chunk</code></h2>

<p>The <code>chunk</code> method splits the receiver object into multiple enumerators, using the rule defined in the block. It keeps together the parts that match in series. It then passes the result of this rule and an enumerator of the successive elements to the given block:</p>

<pre><code>(1..42).chunk{ |n| n % 11 == 0 }.each{ |result, elements|
  puts "#{result}: #{elements * ' - '}"
}
# false: 1 - 2 - 3 - 4 - 5 - 6 - 7 - 8 - 9 - 10
# true: 11
# false: 12 - 13 - 14 - 15 - 16 - 17 - 18 - 19 - 20 - 21
# true: 22
# false: 23 - 24 - 25 - 26 - 27 - 28 - 29 - 30 - 31 - 32
# true: 33
# false: 34 - 35 - 36 - 37 - 38 - 39 - 40 - 41 - 42
</code></pre>

<p>You can use this to order numbers in <a href="https://en.wikipedia.org/wiki/Quotient_ring">quotient rings</a>:</p>

<pre><code>a = (0..4).map{ [] }
(1..42).chunk{ |n| n % 5 }.each{ |remainder, elements|
  a[remainder] += elements
}
puts a.map(&amp;:inspect)
# [5, 10, 15, 20, 25, 30, 35, 40],    # every number where n % 5 == 0
# [1, 6, 11, 16, 21, 26, 31, 36, 41], # every number where n % 5 == 1
# [2, 7, 12, 17, 22, 27, 32, 37, 42], # every number where n % 5 == 2
# [3, 8, 13, 18, 23, 28, 33, 38],     # every number where n % 5 == 3
# [4, 9, 14, 19, 24, 29, 34, 39]      # every number where n % 5 == 4
</code></pre>

<p>The reason I am bringing it up as <em>idiosyncratic</em> is: You can use <strong>special symbols</strong> to influence the behavior of the chunk method, when used as the block return value. Anyone has seen something like this anywhere else in Ruby?</p>

<p>Let's revisit a shortened version of the example at the top:</p>

<pre><code>(1..42).chunk{ |n| n % 11 == 0 }.to_a
# =&gt; [
#   [false, [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]], [true, [11]],
#   [false, [12, 13, 14, 15, 16, 17, 18, 19, 20, 21]], [true, [22]],
#   [false, [23, 24, 25, 26, 27, 28, 29, 30, 31, 32]], [true, [33]],
#   [false, [34, 35, 36, 37, 38, 39, 40, 41, 42]]
# ]
</code></pre>

<p>It does nothing, when you pass in an arbitrary symbol as filter rule:</p>

<pre><code>(1..42).chunk{ :symbol }.to_a
# =&gt; [
#   [:symbol, [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
#   18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
#   36, 37, 38, 39, 40, 41, 42]]
# ]
</code></pre>

<p>However, when passing the special symbol <code>:_alone</code>, every element will be separated:</p>

<pre><code>(1..42).chunk{ :_alone }.to_a
# =&gt; [
#   [:_alone, [1]], [:_alone, [2]], [:_alone, [3]], [:_alone, [4]], [:_alone, [5]],
#   [:_alone, [6]], [:_alone, [7]], [:_alone, [8]], [:_alone, [9]], [:_alone, [10]],
#   [:_alone, [11]], [:_alone, [12]], [:_alone, [13]], [:_alone, [14]],
#   [:_alone, [15]], [:_alone, [16]], [:_alone, [17]], [:_alone, [18]],
#   [:_alone, [19]], [:_alone, [20]], [:_alone, [21]], [:_alone, [22]],
#   [:_alone, [23]], [:_alone, [24]], [:_alone, [25]], [:_alone, [26]],
#   [:_alone, [27]], [:_alone, [28]], [:_alone, [29]], [:_alone, [30]],
#   [:_alone, [31]], [:_alone, [32]], [:_alone, [33]], [:_alone, [34]],
#   [:_alone, [35]], [:_alone, [36]], [:_alone, [37]], [:_alone, [38]],
#   [:_alone, [39]], [:_alone, [40]], [:_alone, [41]], [:_alone, [42]]
# ]
</code></pre>

<p>There is also the special symbol <code>:_separator</code>, which drops every element:</p>

<pre><code>(1..42).chunk{ :_separator }.to_a
# =&gt; []
</code></pre>

<p>Normally you don't want to return <code>:_alone</code> or <code>:_separator</code> for every element, but in specific instances of your filter rule, which is legit. The question remains, is this a good API for the future of Ruby?</p>

<p>One more thing: Unknown <strong>special symbols</strong> (those that start with <code>_</code>) will raise a <code>RuntimeError</code>:</p>

<pre><code>(1..42).chunk{ :_future }.to_a
# RuntimeError: symbols beginning with an underscore are reserved
</code></pre>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://ruby-doc.org/core/Enumerable.html#method-i-chunk">RDoc Enumerable#chunk</a></li>
</ul>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/3960df1d8d02e577221088f0f8d87a0345ad0390#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/20-better-standards.html">Better Standards</a></li>
            <li>Previous Article: <a href="/18-con-struct-attributes.html">Con-Struct Attributes</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Core, Enumerable, Symbols<br>
        Last Update: December 25, 2017
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>